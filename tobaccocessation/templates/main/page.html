{% extends "base.html" %}
{% load render accessible %}

{% block title %}{{section.label}}{% endblock %}

{% block extrahead %}
    {{ block.super }}
    {% for block in section.pageblock_set.all %}
        {% rendercss block %}
    {% endfor %}
{% endblock %}

{% block js %}
    {{ block.super }}
    <script type="text/javascript" src="/site_media/js/json2.js"></script>
    <script type="text/javascript" src="/site_media/js/quizblockextra.js"></script>
    
    <script type="text/javascript">    
        jQuery(document).ready(function () {            
            jQuery("form").submit(function() {
                var valid = true;

                var children = jQuery(this).find("input,textarea,select");
                jQuery.each(children, function() {
                    if (valid) {
                        if (this.tagName === 'INPUT' && this.type === 'text' ||
                            this.tagName === 'TEXTAREA') {
                            valid = jQuery(this).val().trim().length > 0;
                        }

                        if (this.tagName === 'SELECT') {
                            var value = jQuery(this).val()
                            valid = value !== undefined && value.length > 0 &&
                                jQuery(this).val().trim() !== '-----';
                        }

                        if (this.type === 'checkbox' || this.type === 'radio') {
                            // one in the group needs to be checked
                            var selector = 'input[name=' + jQuery(this).attr("name") + ']';
                            valid = jQuery(selector).is(":checked");
                        }
                    }
                });

                if (!valid) {
                    alert("Please complete all form fields before continuing.");
                }

                return valid;
            });
        });
    </script>    
    
{% endblock %}

{% block extrajs %}
    {{ block.super }}
    {% for block in section.pageblock_set.all %}
        {% renderjs block %}
    {% endfor %}
{% endblock %}

{% block primarynavtabs %}
    {% if user.is_authenticated %}
        {% include "new_project_primary_nav.html" %}
    {% endif %}
{% endblock %}


{% block extraprimarynav %}
    {% if user.is_staff %}
    <ul class="nav pull-right">
        <li><a href="{{section.get_edit_url}}">Edit Page</a></li>
        
        {% if needs_submit and is_submitted %}
            <li>
                <form action="." method="post">
                    <input type="hidden" name="action" value="reset" />
                    <input type="submit" value="Reset" class="btn pull-right" />
                </form>
            </li>
        {% endif %}
    </ul>
    {% endif %}
{% endblock %}

{% block content %}
   {% if not accessible %}
      <br />
      This page is not currently accessible. Please complete your current section before moving onto a new section.
   {% else %}
        {% if needs_submit %}
            {% if is_submitted %}
            {% else %}
                <form action="." method="post">
            {% endif %}
        {% endif %}
        
		<h2>{{ section.label }}</h2>
		
        {% for block in section.pageblock_set.all %}
            {% if block.label %}
                <h3>{{block.label}}</h3>
            {% endif %}
            <div class="pageblock{% if block.css_extra %} {{block.css_extra}}{% endif %}">
                {% render block %}
            </div>
        {% endfor %}
        
        {% if needs_submit %}
            {% if request.user.is_anonymous %}
            {% else %}
                <div class="visualclear"></div>        
                {% if is_submitted %}
                    {% if allow_redo %}
                    <form action="." method="post">
                    <input type="hidden" name="action" value="reset" />
                    <input type="submit" value="try again" class="btn pull-right" />
                    </form>
                    {% endif %}
                {% else %}                    
                    <input type="submit" value="Submit" class="btn btn-primary pull-right" />
                    <div class="visualclear"></div>                
                    </form>
                {% endif %}
            {% endif %}
        {% endif %}
   {% endif %}		
{% endblock %}


{% block contentnav %}
    <div class="navbar footer">
        <div class="navbar-inner">
            {% if previous %}
            <ul class="nav">
                <li>
                    {% ifaccessible previous %}
                        <a href="{{previous.get_absolute_url}}" id="previous">« {{previous.label}}</a>
                    {% else %}
                        <div id="prev_disabled">« {{previous.label}} <img align="top" src="/site_media/img/lock.png"/></div>
                    {% endifaccessible %}
                </li>
            </ul>
            {% endif %}
        
            {% if next %}
            <ul class="nav pull-right">
                <li>
                     <!-- added to allow javascript access to the menu links. hack for the js activities enabling/disabling of links -->
                     <input type="hidden" id="next_section_slug" name="next_section_slug" value="{{next.slug}}"/>
                     {% ifaccessible next %}
                        <a href="{{next.get_absolute_url}}" id="next">{{next.label}} »</a>
                        <div style="display: none;" id="next_disabled">{{next.label}} <img align="top" src="/site_media/img/lock.png" alt="locked"/></div>
                     {% else %}
                        <a style="display: none" href="{{next.get_absolute_url}}" id="next">{{next.label}} »</a>
                        <div id="next_disabled" title="You must complete the activities on this page before continuing.">
                            <img align="top" src="/site_media/img/lock.png" alt="locked"/> {{next.label}} »
                        </div>
                     {% endifaccessible %}            
                </li>
            </ul>
            {% endif %}
    
        </div>
    </div>
    
{% endblock %}
