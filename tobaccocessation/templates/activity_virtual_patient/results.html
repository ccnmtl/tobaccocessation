{% load user_state %}

{% with block.patient as patient %}
{% getfeedback block as feedback %}

<div class="virtualpatient results">
    <div class="row">
        <div class="span12 well about-patient">
            <div class="row">
                <div class="span6">
                    <img class="pull-left" src="/activity/virtualpatient/media/images/patient_{{patient.id}}.jpg" />
                    <div class="patient-description">                
                        <h3>{{patient.name}}</h3>
                        <h5>{% autoescape off %}{{ patient.description }}{% endautoescape %} </h5> 
                    </div>
                </div>
                <div class="span6">
                    <div class="treatment-feedback">
                    asd;lfkjasdfk
                        {{results.treatment_feedback|safe}}
                    </div>
                </div>
            </div>
        </div>  
    </div>
    
    <h3>Our Recommended Treatment Classifications</h3>
    
    <div class="row">
        <div class="span4 well treatment-option-reasoning appropriate-treatment-choice">
            <h4>Appropriate Treatment Choices</h4>
            <div>
            {% for to in patient.treatmentoptionreasoning_set.all %}
                {% ifequal to.classification.rank 1 %}
                    {% if to.combination %}
                        <img src='/activity/virtualpatient/media/images/combination.jpg'>
                    {% else %}
                        <img src='/activity/virtualpatient/media/images/{{to.medication.tag}}.jpg'>
                    {% endif %}
                {% endifequal %}
            {% endfor %}
            </div>
        </div>
        <div class="span4 well treatment-option-reasoning unlikely-to-be-effective">
            <h4>Unlikely To Be Effective</h4>
            <div>
            {% for to in patient.treatmentoptionreasoning_set.all %}
                {% ifequal to.classification.rank 2 %}
                    {% if to.combination %}
                        <img src='/activity/virtualpatient/media/images/combination.jpg'>
                    {% else %}
                        <img src='/activity/virtualpatient/media/images/{{to.medication.tag}}.jpg'>
                    {% endif %}
                {% endifequal %}
            {% endfor %}
            </div>
        </div>
        <div class="span4 well treatment-option-reasoning potentially-harmful">
            <h4>Potentially Harmful</h4>
            <div>
            {% for to in patient.treatmentoptionreasoning_set.all %}
                {% ifequal to.classification.rank 3 %}
                    {% if to.combination %}
                        <img src='/activity/virtualpatient/media/images/combination.jpg'>
                    {% else %}
                        <img src='/activity/virtualpatient/media/images/{{to.medication.tag}}.jpg'>
                    {% endif %}
                {% endifequal %}
            {% endfor %}
            </div>
        </div>
    </div>
  
    <div class="row">
        <div class="span12">
            <h3 class="best">Appropriate Treatment Choice(s)</h3>
	        <div class="treatment_reasoning">
                {% for to in patient.treatmentoptionreasoning_set.all %}
                    {% ifequal to.classification.rank 1 %} 
                        {% if to.combination %}
                            <h4>Combination Therapy</h4><p>{% autoescape off %}{{ to.reasoning }}{% endautoescape %}</p>
                        {% else %}
                            <h4>{{to.medication.name}}</h4><p>{% autoescape off %}{{ to.reasoning }}{% endautoescape %}</p>
                        {% endif %}
                    {% endifequal %}
                {% endfor %}
            </div>
           
            <h3 class="ineffective">Unlikely To Be Effective</h3>
            <div class="treatment-reasoning">
                {% for to in patient.treatmentoptionreasoning_set.all %}
                    {% ifequal to.classification.rank 2 %} 
                        {% if to.combination %}
                            <h4>Combination Therapy</h4><p>{% autoescape off %}{{ to.reasoning }}{% endautoescape %}</p>
                        {% else %}
                            <h4>{{to.medication.name}}</h4><p>{% autoescape off %}{{ to.reasoning }}{% endautoescape %}</p>
                        {% endif %}
                    {% endifequal %}
                {% endfor %}
            </div>
           
            <h3 class="harmful">Potentially Harmful</h3>
            <div class="treatment_reasoning">
                {% for to in patient.treatmentoptionreasoning_set.all %}
                    {% ifequal to.classification.rank 3 %} 
                        {% if to.combination %}
                            <h4>Combination Therapy</h4><p>{% autoescape off %}{{ to.reasoning }}{% endautoescape %}</p>
                        {% else %}
                            <h4>{{to.medication.name}}</h4><p>{% autoescape off %}{{ to.reasoning }}{% endautoescape %}</p>
                        {% endif %}
                    {% endifequal %}
                {% endfor %}
           </div>
       </div>
    </div>

    <form action="." method="post" class="pull-left">
        <input type="hidden" name="action" value="reset" />
        <input type="submit" value="Reset Patient Assessment" class="btn" />
    </form>    
</div>
{% endwith %}